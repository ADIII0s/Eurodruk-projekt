<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Warsztat – panel serwisanta</title>
<style>
:root{
  --bg:#0f1216; --panel:#161b22; --panel-2:#0f141b;
  --muted:#a9b1bb; --text:#e7edf5;
  --accent:#33c3ff; --accent-2:#7a7cff;
  --ok:#3ddc97; --warn:#ffb020;
  --radius:18px; --gap:14px;
  --shadow:0 10px 24px rgba(0,0,0,.35), 0 1px 0 rgba(255,255,255,.03) inset;
  --border:1px solid rgba(255,255,255,.06);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; background:linear-gradient(180deg,#0b0e12 0%, var(--bg) 100%);
  color:var(--text); font:14px/1.45 system-ui,Segoe UI,Roboto,Ubuntu,Arial;
}

/* Layout */
.app{
  max-width:1400px; margin-inline:auto; padding:24px; display:grid;
  grid-template-columns: 1fr 1.25fr; gap:24px;
}
@media (max-width:1060px){ .app{grid-template-columns:1fr} }

/* Panels */
.panel{
  background: radial-gradient(120% 120% at 0% 0%, #121720 0%, var(--panel) 50%, var(--panel-2) 100%);
  border:var(--border); border-radius:calc(var(--radius) + 6px);
  box-shadow:var(--shadow); padding:18px;
}
.panel h2{
  margin:0 0 12px; font-size:15px; letter-spacing:.3px; font-weight:600; color:#dce6f2;
}

/* LEWA kolumna – baza awarii + filtry */
.left{
  display:flex;
  flex-direction:column;
  min-height:640px;
}
.list{
  display:flex; flex-direction:column; gap:10px; padding:8px;
  border-radius:var(--radius); background:rgba(0,0,0,.15); border:var(--border);
  max-height:360px; overflow:auto; scroll-behavior:smooth;
}
.item{
  display:grid; grid-template-columns:auto 90px; gap:10px; align-items:center;
  padding:12px 14px; border-radius:12px; background:rgba(255,255,255,.03);
  border:1px solid rgba(255,255,255,.06); cursor:pointer;
}
.item:hover{outline:1px solid rgba(51,195,255,.25); background:rgba(255,255,255,.05)}
.item.active{outline:1px solid rgba(51,195,255,.45); background:rgba(51,195,255,.06)}
.item .title{font-weight:600}
.item .meta{color:var(--muted); font-size:12px}
.badge{font-size:12px; padding:4px 10px; border-radius:999px; text-align:center}
.badge.ok{background:rgba(61,220,151,.18); color:#a3f3d3; border:1px solid rgba(61,220,151,.35)}
.badge.open{background:rgba(255,176,32,.15); color:#ffd18a; border:1px solid rgba(255,176,32,.35)}
.empty{color:var(--muted); padding:6px 4px}

/* Filtry przyklejone na dole */
.filters-wrap{
  margin-top:16px;
}

.toolbar-row{display:flex; gap:8px; flex-wrap:wrap; margin:12px 0 10px}
.btn{
  padding:8px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.18);
  background:rgba(255,255,255,.06); color:var(--text); cursor:pointer; user-select:none;
  font-size:13px;
}
.btn:hover{background:rgba(255,255,255,.12)}
.btn.toggle.active{
  background:linear-gradient(90deg, rgba(51,195,255,.22), rgba(122,124,255,.22));
  border-color:rgba(51,195,255,.35);
}
.btn.accent{border-color:rgba(51,195,255,.35); background:rgba(51,195,255,.12)}
.btn.ghost{background:transparent}

.filters{
  display:grid; grid-template-columns:repeat(2,1fr); gap:10px;
  padding:12px; border-radius:14px; border:var(--border); background:rgba(255,255,255,.03);
}
.filters label{
  display:grid; gap:6px; font-size:12px; color:var(--muted);
}
.filters input{
  padding:8px 10px; border-radius:10px; border:1px solid rgba(255,255,255,.18);
  background:rgba(0,0,0,.25); color:var(--text);
}
.filter-actions{
  grid-column:1/-1; display:flex; gap:8px; justify-content:flex-end;
}

/* Details column */
.details{display:grid; grid-template-rows:auto auto auto auto; gap:16px}
.place{
  padding:14px 16px; border-radius:14px; background:rgba(255,255,255,.03);
  border:1px solid rgba(255,255,255,.06); font-weight:600;
}

/* Dwie kolumny: LEWO opis, PRAWO rolka zdjęć */
.header-row{
  display:grid;
  grid-template-columns:minmax(0,1fr) 360px;
  gap:24px;
  align-items:start;
}
@media (max-width:1060px){ .header-row{grid-template-columns:1fr} }

/* Zakładki */
.tabs{display:grid; gap:10px; position:relative}
.tabs > input{position:absolute; opacity:0; pointer-events:none}

.tab-head{
  display:flex; gap:8px; flex-wrap:wrap;
  background:rgba(255,255,255,.03); padding:6px;
  border-radius:999px; border:1px solid rgba(255,255,255,.06)
}
.tab-head label{
  cursor:pointer; padding:6px 12px; border-radius:999px; color:var(--muted); font-size:13px;
}
#t1:checked ~ .tab-head label[for="t1"],
#t2:checked ~ .tab-head label[for="t2"]{
  color:var(--text);
  background:linear-gradient(90deg, rgba(51,195,255,.22), rgba(122,124,255,.22));
  outline:1px solid rgba(51,195,255,.35)
}

.tab-body{position:relative}
.tab-panel{
  display:none; height:260px; overflow:auto; padding:14px 16px;
  border-radius:14px; border:1px solid rgba(255,255,255,.06);
  background:rgba(255,255,255,.03);
}
#t1:checked ~ .tab-body #p1{display:block}
#t2:checked ~ .tab-body #p2{display:block}

/* ROLKA ZDJĘĆ — jedyne miejsce wyświetlania */
.photo-strip{
  display:grid; gap:10px;
  grid-auto-flow:column;
  grid-auto-columns:minmax(180px,1fr);
  height:320px;
  overflow:auto;
  scroll-snap-type:x mandatory;
  padding:8px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.06);
  background:rgba(255,255,255,.03);
}
.photo{
  border-radius:12px;
  border:1px solid rgba(255,255,255,.07);
  scroll-snap-align:center;
  overflow:hidden;
  display:flex; align-items:center; justify-content:center;
  color:var(--muted); position:relative; cursor:pointer;
}
.photo img{width:100%; height:100%; object-fit:cover; display:block}

/* Pasek akcji pod szczegółami */
.actions-row{
  margin-top:4px;
  padding:14px 22px;
  border-radius:32px;
  border:var(--border);
  background:rgba(0,0,0,.25);
  display:flex;
  justify-content:center;
  gap:40px;
}
.action-btn{
  min-width:200px;
  padding:12px 22px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.16);
  background:rgba(255,255,255,.04);
  color:var(--text);
  font-size:14px;
  cursor:pointer;
}
.action-btn.primary{
  background:linear-gradient(90deg,var(--accent),var(--accent-2));
  border:none;
}
.action-btn:hover{filter:brightness(1.05)}

/* Dolny panel DUR */
.dur-panel{
  grid-column:1 / -1;
  display:grid;
  grid-template-columns:260px minmax(0,1.1fr) minmax(0,1.1fr);
  gap:18px;
  align-items:stretch;
}
@media (max-width:1060px){
  .dur-panel{
    grid-template-columns:1fr;
  }
}
.dur-main-btn{
  border:none;
  border-radius:40px;
  background:linear-gradient(145deg,#ff3131,#ff5b3c);
  color:#ffecec;
  font-weight:700;
  font-size:22px;
  letter-spacing:.08em;
  text-transform:uppercase;
  padding:32px 16px;
  cursor:pointer;
  text-align:center;
  box-shadow:0 18px 40px rgba(0,0,0,.6);
}
.dur-main-btn span{display:block}
.dur-field{
  display:flex;
  flex-direction:column;
  gap:10px;
}
.dur-input,
.dur-textarea{
  width:100%;
  border-radius:22px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.32);
  padding:12px 16px;
  color:var(--text);
  font:inherit;
}
.dur-input::placeholder,
.dur-textarea::placeholder{color:var(--muted)}
.dur-textarea{
  min-height:70px;
  resize:vertical;
}
.dur-label{
  font-size:12px;
  color:var(--muted);
  padding-left:4px;
}

/* Lightbox */
.lightbox{
  position:fixed; inset:0; background:rgba(0,0,0,.9);
  display:none; align-items:center; justify-content:center; z-index:9999;
}
.lightbox.open{display:flex}
.lightbox img{max-width:min(92vw,1600px); max-height:92vh; border-radius:12px}
.lightbox .close{
  position:absolute; top:16px; right:16px; background:rgba(255,255,255,.1);
  border:1px solid rgba(255,255,255,.25); color:#fff; padding:8px 12px; border-radius:10px; cursor:pointer;
}

/* Modal „zamknij zgłoszenie” */
.close-dialog-backdrop{
  position:fixed; inset:0; background:rgba(0,0,0,.88);
  display:none; align-items:center; justify-content:center; z-index:9998;
}
.close-dialog-backdrop.open{display:flex}
.close-dialog{
  width:min(780px,90vw);
  background: radial-gradient(140% 140% at 0% 0%, #151b25 0%, var(--panel) 50%, var(--panel-2) 100%);
  border-radius:44px;
  border:var(--border);
  box-shadow:var(--shadow);
  padding:26px 26px 22px;
  display:flex;
  flex-direction:column;
  gap:16px;
  position:relative;
}
.close-dialog-header{
  text-align:center;
  font-size:14px;
  color:var(--muted);
  margin-bottom:4px;
}
.close-dialog textarea{
  border-radius:32px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(0,0,0,.33);
  padding:16px 18px;
  min-height:260px;
  resize:vertical;
  color:var(--text);
  font:inherit;
}
.close-dialog textarea::placeholder{color:var(--muted)}
.close-dialog-actions{
  margin-top:8px;
  display:flex;
  justify-content:center;
  gap:24px;
}
.close-dialog-btn{
  min-width:180px;
  padding:11px 20px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.18);
  background:rgba(255,255,255,.05);
  color:var(--text);
  cursor:pointer;
  font-size:14px;
}
.close-dialog-btn.primary{
  background:linear-gradient(90deg,var(--accent),var(--accent-2));
  border:none;
}
.close-dialog-btn:hover{filter:brightness(1.05)}
.close-dialog-close-x{
  position:absolute;
  top:18px;
  right:24px;
  background:transparent;
  border:none;
  color:var(--muted);
  cursor:pointer;
  font-size:20px;
}
</style>
</head>
<body>
  <main class="app">

    <!-- LEWA: Baza awarii + filtry -->
    <section class="panel left">
      <h2>Baza awarii</h2>

      <div class="list" id="ticketsList" aria-label="Baza awarii"></div>

      <div class="filters-wrap">
        <div class="toolbar-row">
          <button class="btn toggle" data-sort="date" id="sortBtn">Sortuj ↓ data</button>
          <button class="btn toggle" data-machine="KBA">KBA</button>
          <button class="btn toggle" data-line="L2">L2</button>
          <button class="btn toggle" data-line="L3">L3</button>
          <button class="btn toggle" data-machine="DUR">DUR</button>
          <button class="btn toggle" data-machine="INTRO">INTRO</button>
        </div>

        <div class="filters">
          <label>
            <span>Data od</span>
            <input type="date" id="fFrom" placeholder="dd.mm.rrrr">
          </label>
          <label>
            <span>Data do</span>
            <input type="date" id="fTo" placeholder="dd.mm.rrrr">
          </label>
          <label>
            <span>Miejsce / segment</span>
            <input type="text" id="fPlace" placeholder="np. falcownik">
          </label>
          <label>
            <span>Kod błędu</span>
            <input type="text" id="fErr" placeholder="np. E42">
          </label>
          <label style="grid-column:1/-1">
            <span>Fragment opisu</span>
            <input type="text" id="fText" placeholder="szukaj w treści">
          </label>

          <div class="filter-actions">
            <button class="btn accent" id="applyBtn">Szukaj</button>
            <button class="btn ghost" id="clearBtn">Wyczyść</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Prawa kolumna – szczegóły + zdjęcia + przyciski -->
    <section class="panel details">
      <h2>Szczegóły zgłoszenia</h2>
      <div id="place" class="place">Wybierz zgłoszenie z listy po lewej.</div>

      <div class="header-row">

        <!-- LEWO: zakładki + opis -->
        <div class="tabs">
          <input type="radio" id="t1" name="tabs" checked>
          <input type="radio" id="t2" name="tabs">

          <div class="tab-head">
            <label for="t1">Opis operatora</label>
            <label for="t2">Co zrobił serwisant</label>
          </div>

          <div class="tab-body">
            <div id="p1" class="tab-panel" aria-live="polite"></div>
            <div id="p2" class="tab-panel" aria-live="polite"></div>
          </div>
        </div>

        <!-- PRAWO: rolka zdjęć -->
        <aside id="photos" aria-label="Zdjęcia" class="photo-strip">
          <!-- Dynamicznie z JS -->
        </aside>

      </div>

      <!-- Pasek przycisków -->
      <div class="actions-row">
        <button class="action-btn primary" id="btnCloseTicket">Zamknij zgłoszenie</button>
        <button class="action-btn" id="btnStartWork">Rozpocznij pracę</button>
      </div>
    </section>

    <!-- Dolny panel DUR -->
    <section class="panel dur-panel">
      <button class="dur-main-btn">
        <span>Zgłoś</span>
        <span>usterkę</span>
        <span>DUR</span>
      </button>

      <div class="dur-field">
        <div class="dur-label">Lokalizacja</div>
        <input class="dur-input" type="text" placeholder="Lokalizacja maszyny / linii / stanowiska">
        <div class="dur-label">Co się zepsuło?</div>
        <input class="dur-input" type="text" placeholder="Krótki opis elementu lub objawu">
      </div>

      <div class="dur-field">
        <div class="dur-label">Generaly opis zdarzenia</div>
        <textarea class="dur-textarea" placeholder="Co się wydarzyło? Jakie były objawy, warunki pracy, wcześniejsze problemy?"></textarea>
      </div>
    </section>

  </main>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox" role="dialog" aria-modal="true" aria-label="Podgląd zdjęcia">
    <button class="close" id="lbClose" aria-label="Zamknij">Zamknij</button>
    <img id="lbImg" alt="">
  </div>

  <!-- Modal zamknięcia zgłoszenia -->
  <div id="closeDialogBackdrop" class="close-dialog-backdrop" role="dialog" aria-modal="true" aria-label="Zamknij zgłoszenie">
    <div class="close-dialog">
      <button class="close-dialog-close-x" id="closeDialogX" aria-label="Zamknij okno">×</button>
      <div class="close-dialog-header">
        Dodaj opis zdarzenia, co zrobiłeś, co wymieniłeś, uwagi, co można zrobić lepiej?
      </div>
      <textarea id="closeDialogText" placeholder="Opis wykonanych czynności serwisowych, wymienionych części, przyczyny usterki, propozycje usprawnień..."></textarea>
      <div class="close-dialog-actions">
        <button class="close-dialog-btn" id="btnAddPhoto">Dodaj zdjęcie. Wyszukaj.</button>
        <button class="close-dialog-btn primary" id="btnConfirmClose">Zamknij zgłoszenie</button>
      </div>
    </div>
  </div>

<script>
/* Dane mock – możesz podpiąć Blazora zamiast tego */
const TICKETS = [
  {
    id: 1,
    title: "KBA Compacta 818 — sekcja 3 — błąd E42",
    meta: "Zgłoszono: 2025-01-05 12:04 | Operator: J.D.",
    status: "open",
    place: "KBA C818 → Sekcja 3 → Kod: E42",
    op: `Podczas startu sekcji 3 pojawia się błąd E42. Maszyna nie pobiera
         wstęgi z odwijaka. Po skasowaniu błąd wraca natychmiast. Podejrzenie
         czujnika prędkości rolki prowadzącej.<br><br>Dodatkowe uwagi: sporadyczny pisk łożyska po lewej.`,
    svc: `Sprawdzono zasilanie czujnika — OK. Wymieniono czujnik prędkości,
          wyczyszczono kostkę. Dokręcono rolkę prowadzącą, nasmarowano łożyska
          smarem wysokotemperaturowym. Test: 30 min bez powrotu błędu.
          <hr class="sep"><span class="small">Uwagi: zalecana wymiana łożysk w serwisie planowym.</span>`,
    photos: [
      "https://picsum.photos/1000/700?random=11",
      "https://picsum.photos/1000/700?random=12",
      "https://picsum.photos/1000/700?random=13"
    ],
    machine: "KBA",
    line: "L3",
    error: "E42",
    date: "2025-01-05"
  },
  {
    id: 2,
    title: "Roland Lithoman IV — odwijak A — czujnik taśmy",
    meta: "Zgłoszono: 2025-01-04 10:31 | Operator: A.K.",
    status: "open",
    place: "Roland Lithoman IV → Odwijak A → Czujnik taśmy",
    op: "W trakcie biegu maszyny czujnik taśmy gubi impuls. Pasek zatrzymuje się.",
    svc: "Wymiana czujnika oraz korekta prowadzenia przewodu. Test 2 h.",
    photos: [
      "https://picsum.photos/1000/700?random=21"
    ],
    machine: "KBA",
    line: "L2",
    error: "E07",
    date: "2025-01-04"
  },
  {
    id: 3,
    title: "Kompresor Atlas — wymiana filtra oleju",
    meta: "Zamknięto: 2025-01-03 09:12 | Serwis: M.S.",
    status: "ok",
    place: "Kompresor Atlas → Filtr oleju",
    op: "Wzrost temperatury o 15°C. Filtr oleju zatarasowany.",
    svc: "Wymieniono filtr, uruchomiono, temp. w normie.",
    photos: [],
    machine: "DUR",
    line: "L2",
    error: "",
    date: "2025-01-03"
  }
];

const $list   = document.getElementById('ticketsList');
const $place  = document.getElementById('place');
const $p1     = document.getElementById('p1');
const $p2     = document.getElementById('p2');
const $photos = document.getElementById('photos');

let selectedId = null;

/* Filtry */
const F = {
  from: null,
  to: null,
  place: "",
  text: "",
  err: "",
  machine: new Set(),
  line: new Set()
};

function applyFilters(arr){
  let q = [...arr];

  // sort: otwarte na górze, potem data malejąco
  q.sort((a,b)=>{
    const aOpen = a.status !== "ok" ? 0 : 1;
    const bOpen = b.status !== "ok" ? 0 : 1;
    const d = aOpen - bOpen;
    if(d !== 0) return d;
    const da = new Date(a.date || "1970-01-01");
    const db = new Date(b.date || "1970-01-01");
    return db - da;
  });

  if(F.machine.size) q = q.filter(t => F.machine.has(t.machine));
  if(F.line.size)    q = q.filter(t => F.line.has(t.line));
  if(F.from)         q = q.filter(t => new Date(t.date || "1970-01-01") >= new Date(F.from));
  if(F.to)           q = q.filter(t => new Date(t.date || "1970-01-01") <= new Date(F.to));
  if(F.place)        q = q.filter(t => (t.place || "").toLowerCase().includes(F.place.toLowerCase()));
  if(F.err)          q = q.filter(t => (t.error || "").toLowerCase().includes(F.err.toLowerCase()));
  if(F.text)         q = q.filter(t => ((t.op || "") + (t.svc || "")).toLowerCase().includes(F.text.toLowerCase()));

  return q;
}

function renderList(){
  const data = applyFilters(TICKETS);
  $list.innerHTML = '';

  if(!data.length){
    const empty = document.createElement('div');
    empty.className = 'empty';
    empty.textContent = 'Brak zgłoszeń dla wybranych filtrów.';
    $list.appendChild(empty);

    selectedId = null;
    $place.textContent = 'Brak wyników. Zmień filtry lub wybierz inną maszynę.';
    $p1.innerHTML = '';
    $p2.innerHTML = '';
    $photos.innerHTML = '';
    const ph = document.createElement('div');
    ph.className = 'photo';
    ph.textContent = 'Brak zdjęć';
    $photos.appendChild(ph);
    return;
  }

  let firstSelectableId = null;

  data.forEach(t=>{
    const el = document.createElement('article');
    el.className = 'item' + (t.id === selectedId ? ' active' : '');
    el.dataset.id = t.id;
    el.innerHTML = `
      <div>
        <div class="title">${t.title}</div>
        <div class="meta">${t.meta}</div>
      </div>
      <div><span class="badge ${t.status === 'ok' ? 'ok' : 'open'}">${t.status === 'ok' ? 'zamknięte' : 'otwarte'}</span></div>
    `;
    el.addEventListener('click', ()=>selectTicket(t.id));
    $list.appendChild(el);
    if(firstSelectableId === null) firstSelectableId = t.id;
  });

  if(selectedId === null || !data.some(t=>t.id === selectedId)){
    selectTicket(firstSelectableId);
  }else{
    selectTicket(selectedId);
  }
}

function selectTicket(id){
  selectedId = id;
  [...$list.children].forEach(n=>{
    const nid = Number(n.dataset.id);
    n.classList.toggle('active', nid === id);
  });

  const t = TICKETS.find(x=>x.id === id);
  if(!t) return;

  $place.textContent = "Miejsce: " + t.place;
  $p1.innerHTML = t.op || '';
  $p2.innerHTML = t.svc || '';

  // zdjęcia
  $photos.innerHTML = '';
  if(!t.photos || t.photos.length === 0){
    const empty = document.createElement('div');
    empty.className = 'photo';
    empty.textContent = 'Brak zdjęć';
    $photos.appendChild(empty);
  } else {
    t.photos.forEach(src=>{
      const fig = document.createElement('figure');
      fig.className = 'photo';
      fig.innerHTML = `<img src="${src}" alt="">`;
      fig.addEventListener('click', ()=>openLightbox(src));
      $photos.appendChild(fig);
    });
  }
}

/* Togglery filtrów */
function toggleBtn(btn, group){
  btn.classList.toggle('active');
  const val = btn.dataset[group];
  if(!val) return;
  const set = F[group];
  if(btn.classList.contains('active')) set.add(val); else set.delete(val);
  renderList();
}

document.querySelectorAll('[data-machine]').forEach(b=>{
  b.addEventListener('click', ()=>toggleBtn(b,'machine'));
});
document.querySelectorAll('[data-line]').forEach(b=>{
  b.addEventListener('click', ()=>toggleBtn(b,'line'));
});

/* Zastosuj / wyczyść filtry */
document.getElementById('applyBtn').addEventListener('click', ()=>{
  F.from  = document.getElementById('fFrom').value || null;
  F.to    = document.getElementById('fTo').value   || null;
  F.place = document.getElementById('fPlace').value;
  F.err   = document.getElementById('fErr').value;
  F.text  = document.getElementById('fText').value;
  renderList();
});

document.getElementById('clearBtn').addEventListener('click', ()=>{
  ['fFrom','fTo','fPlace','fErr','fText'].forEach(id=>document.getElementById(id).value='');
  F.from = F.to = null;
  F.place = F.err = F.text = "";
  F.machine.clear();
  F.line.clear();
  document.querySelectorAll('.btn.toggle.active').forEach(b=>b.classList.remove('active'));
  renderList();
});

/* Lightbox */
const $lb     = document.getElementById('lightbox');
const $lbImg  = document.getElementById('lbImg');
const $lbClose= document.getElementById('lbClose');

function openLightbox(src){
  $lbImg.src = src;
  $lb.classList.add('open');
}
function closeLightbox(){
  $lb.classList.remove('open');
  $lbImg.src = '';
}

$lb.addEventListener('click', (e)=>{ if(e.target === $lb) closeLightbox(); });
$lbClose.addEventListener('click', closeLightbox);

/* Modal „zamknij zgłoszenie” */
const $closeBackdrop   = document.getElementById('closeDialogBackdrop');
const $btnCloseTicket  = document.getElementById('btnCloseTicket');
const $closeX          = document.getElementById('closeDialogX');
const $btnConfirmClose = document.getElementById('btnConfirmClose');

function openCloseDialog(){
  $closeBackdrop.classList.add('open');
}
function closeCloseDialog(){
  $closeBackdrop.classList.remove('open');
}

$btnCloseTicket.addEventListener('click', openCloseDialog);
$closeBackdrop.addEventListener('click', e=>{
  if(e.target === $closeBackdrop) closeCloseDialog();
});
$closeX.addEventListener('click', closeCloseDialog);
$btnConfirmClose.addEventListener('click', ()=>{
  // tutaj możesz podpiąć JSInterop / zapis
  closeCloseDialog();
});

/* Esc obsługuje oba okna */
document.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape'){
    closeLightbox();
    closeCloseDialog();
  }
});

/* Init */
renderList();

/* API pod Blazor:
   Wywołaj z C# przez JSInterop: window.updateTicketFromBlazor(ticketObj)
   gdzie ticketObj = {id,title,meta,status,place,op,svc,photos:[],machine,line,error,date}
*/
window.updateTicketFromBlazor = function(ticket){
  const idx = TICKETS.findIndex(x=>x.id === ticket.id);
  if(idx >= 0) TICKETS[idx] = ticket; else TICKETS.unshift(ticket);
  renderList();
  selectTicket(ticket.id);
};
</script>
</body>
</html>