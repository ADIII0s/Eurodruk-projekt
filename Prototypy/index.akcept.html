<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Warsztat – panel kierownika</title>
<style>
:root{
  --bg:#151a23; --panel:#1f2735; --panel-2:#181f2b;
  --muted:#c2ccd6; --text:#f3f7fd;
  --accent:#33c3ff; --accent-2:#7a7cff;
  --ok:#44e0a2; --warn:#ffb020;
  --radius:20px; --gap:16px;
  --shadow:0 14px 30px rgba(0,0,0,.38), 0 1px 0 rgba(255,255,255,.05) inset;
  --border:1px solid rgba(255,255,255,.12);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:linear-gradient(180deg,#0f131b 0%, var(--bg) 100%);
  color:var(--text);
  font:15px/1.55 system-ui,Segoe UI,Roboto,Ubuntu,Arial;
}

/* GRID */
.app{
  max-width:1550px;
  margin-inline:auto;
  padding:28px;
  display:grid;
  grid-template-columns:1fr 1.25fr 1fr;
  gap:24px;
}
@media (max-width:1200px){
  .app{grid-template-columns:1fr}
}

.panel{
  background:radial-gradient(120% 120% at 0% 0%,#1a2130 0%,var(--panel) 45%,var(--panel-2) 100%);
  border:var(--border);
  border-radius:calc(var(--radius) + 8px);
  box-shadow:var(--shadow);
  padding:24px;
}
.panel h2{
  margin:0 0 12px;
  font-size:15px;
  font-weight:600;
  color:#dce6f2;
}

/* LEWA LISTA */
.left{display:flex; flex-direction:column; min-height:640px}
.list{
  height:360px;
  overflow:auto;
  display:flex;
  flex-direction:column;
  gap:10px;
  padding:8px;
  border-radius:var(--radius);
  background:rgba(0,0,0,.15);
  border:var(--border);
}
.item{
  display:grid;
  grid-template-columns:auto 110px;
  gap:10px;
  align-items:center;
  padding:12px 14px;
  border-radius:12px;
  background:rgba(255,255,255,.03);
  border:1px solid rgba(255,255,255,.06);
  cursor:pointer;
}
.item:hover{
  outline:1px solid rgba(51,195,255,.25);
  background:rgba(255,255,255,.05);
}
.item.active{
  outline:1px solid rgba(51,195,255,.45);
  background:rgba(51,195,255,.06);
}
.item .title{font-weight:600}
.item .meta{color:var(--muted); font-size:12px}
.badge{
  font-size:12px;
  padding:4px 10px;
  border-radius:999px;
  text-align:center;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:4px;
}
.badge.ok{
  background:rgba(61,220,151,.18);
  color:#a3f3d3;
  border:1px solid rgba(61,220,151,.35);
}
.badge.open{
  background:rgba(255,176,32,.15);
  color:#ffd18a;
  border:1px solid rgba(255,176,32,.35);
}
.badge.check{
  background:#16a34a;
  color:#e5ffe5;
  border:1px solid rgba(22,163,74,.9);
  padding-inline:6px;
}
.empty{color:var(--muted); padding:6px 4px}

/* Filtry na dole */
.filters-wrap{
  margin-top:16px; 
}

.toolbar-row{display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px}
.btn{
  padding:8px 12px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,.18);
  background:rgba(255,255,255,.06);
  color:var(--text);
  cursor:pointer;
  user-select:none;
}
.btn:hover{background:rgba(255,255,255,.12)}
.btn.toggle.active{
  background:linear-gradient(90deg,rgba(51,195,255,.22),rgba(122,124,255,.22));
  border-color:rgba(51,195,255,.35);
}
.btn.accent{
  border-color:rgba(51,195,255,.35);
  background:rgba(51,195,255,.12);
}
.btn.ghost{background:transparent}
.btn.danger{
  border-color:rgba(248,113,113,.7);
  background:rgba(248,113,113,.16);
  color:#fecaca;
}

.filters{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:10px;
  padding:12px;
  border-radius:14px;
  border:var(--border);
  background:rgba(255,255,255,.03);
}
.filters label{
  display:grid;
  gap:6px;
  font-size:13px;
  color:var(--muted);
}
.filters input{
  padding:10px 12px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.22);
  background:rgba(255,255,255,.04);
  color:var(--text);
}
.segment-picker{position:relative}
.segment-trigger{width:100%; text-align:left; border-radius:14px; padding:12px; border:1px solid rgba(255,255,255,.22); background:rgba(255,255,255,.04); color:var(--text); display:flex; justify-content:space-between; align-items:center; cursor:pointer;}
.segment-menu{position:absolute; left:0; right:0; top:calc(100% + 6px); background:var(--panel); border:var(--border); border-radius:16px; box-shadow:var(--shadow); padding:8px; display:none; z-index:50; max-height:320px; overflow:auto;}
.segment-picker.open .segment-menu{display:grid; gap:6px}
.segment-option, .segment-menu button{width:100%; text-align:left; border:none; padding:10px 12px; border-radius:12px; background:rgba(255,255,255,.04); color:var(--text); cursor:pointer;}
.segment-option:hover, .segment-menu button:hover{background:rgba(255,255,255,.08)}
.segment-option.has-sub{position:relative; padding-right:80px;}
.segment-option .segment-submenu{position:absolute; right:8px; top:50%; transform:translateY(-50%); display:none; gap:6px;}
.segment-option.has-sub:hover .segment-submenu{display:flex}
.segment-option .segment-submenu button{width:auto; padding:8px 10px; border:1px solid rgba(255,255,255,.18); background:rgba(255,255,255,.08)}
.filter-actions{
  grid-column:1/-1;
  display:flex;
  gap:8px;
  justify-content:flex-end;
}

/* ŚRODEK */
.details{
  display:grid;
  grid-template-rows:auto auto auto 1fr;
  gap:16px;
  min-height:640px;
}
.place{
  padding:14px 16px;
  border-radius:14px;
  background:rgba(255,255,255,.03);
  border:1px solid rgba(255,255,255,.06);
  font-weight:600;
}

/* Zakładki */
.tabs{display:grid; gap:10px}
.tabs>input{position:absolute; opacity:0; pointer-events:none}
.tab-head{
  display:flex;
  gap:8px;
  padding:6px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.06);
  background:rgba(255,255,255,.03);
  justify-content:center;
}
.tab-head label{
  cursor:pointer;
  padding:6px 14px;
  border-radius:999px;
  color:var(--muted);
  font-size:13px;
  flex:1 1 0;
  text-align:center;
}
#t1:checked ~ .tab-head label[for="t1"],
#t2:checked ~ .tab-head label[for="t2"]{
  color:var(--text);
  background:linear-gradient(90deg,rgba(51,195,255,.22),rgba(122,124,255,.22));
  outline:1px solid rgba(51,195,255,.35);
}

.tab-body{position:relative}
.tab-panel{
  display:none;
  height:200px;
  padding:0;
}
#t1:checked ~ .tab-body #p1{display:block}
#t2:checked ~ .tab-body #p2{display:block}

.tab-panel textarea{
  width:100%;
  height:100%;
  resize:none;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.06);
  background:rgba(255,255,255,.03);
  color:var(--text);
  padding:12px 14px;
  font:inherit;
}

/* Zdjęcia */
.photo-strip{
  display:grid;
  gap:10px;
  grid-auto-flow:column;
  grid-auto-columns:minmax(160px,1fr);
  height:160px;
  overflow:auto;
  scroll-snap-type:x mandatory;
  padding:8px;
  border-radius:14px;
  border:var(--border);
  background:rgba(255,255,255,.03);
}
.photo{
  position:relative;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.07);
  scroll-snap-align:center;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
  color:var(--muted);
}
.photo img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
  cursor:pointer;
}
.photo.empty{justify-content:center}
.photo-remove{
  position:absolute;
  top:6px;
  right:6px;
  border:none;
  border-radius:999px;
  background:rgba(0,0,0,.6);
  color:#fff;
  padding:2px 7px;
  font-size:11px;
  cursor:pointer;
}
.add-photo{
  border-radius:12px;
  border:1px dashed rgba(255,255,255,.35);
  background:rgba(0,0,0,.3);
  color:var(--muted);
  font-size:13px;
  cursor:pointer;
}

/* Długie przyciski */
.wide-btn{
  margin-top:auto;
  width:100%;
  padding:12px 16px;
  border-radius:12px;
  border:1px solid rgba(51,195,255,.35);
  background:rgba(51,195,255,.12);
  color:var(--text);
  cursor:pointer;
}
.wide-btn:disabled{
  opacity:.5;
  cursor:not-allowed;
}

/* PRAWA LISTA – ta sama wysokość co pozostałe */
.right{
  display:flex;
  flex-direction:column;
  min-height:640px;
}
.right .list{
  height:360px;
  overflow:auto;
}
.right-footer{
  margin-top:auto;
  display:flex;
  justify-content:center;
  gap:6px;
  padding-top:10px;
}
.dot{
  width:6px; height:6px;
  border-radius:999px;
  background:rgba(255,255,255,.15);
}
.dot.active{background:rgba(51,195,255,.7)}

/* Lightbox */
.lightbox{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.9);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
.lightbox.open{display:flex}
.lightbox img{
  max-width:min(92vw,1600px);
  max-height:92vh;
  border-radius:12px;
}
.lightbox .close{
  position:absolute;
  top:16px;
  right:16px;
  background:rgba(255,255,255,.1);
  border:1px solid rgba(255,255,255,.25);
  color:#fff;
  padding:8px 12px;
  border-radius:10px;
  cursor:pointer;
}

/* Modal potwierdzenia usunięcia */
.modal{
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,.75);
  z-index:9998;
}
.modal.open{display:flex}
.modal-box{
  width:min(360px,90vw);
  background:var(--panel);
  border-radius:18px;
  border:var(--border);
  box-shadow:var(--shadow);
  padding:18px 20px;
}
.modal-title{
  font-weight:600;
  margin-bottom:8px;
}
.modal-text{
  margin:0 0 18px;
  color:var(--muted);
  font-size:13px;
}
.modal-actions{
  display:flex;
  justify-content:flex-end;
  gap:8px;
}
</style>
</head>
<body>

<main class="app">
  <!-- LEWA: baza zgłoszeń -->
  <section class="panel left">
    <h2>Baza awarii</h2>
    <div class="list" id="allList"></div>

    <div class="filters-wrap">
      <div class="toolbar-row">
        <button class="btn toggle" id="sortBtn">Sortuj ↓ data</button>
        <button class="btn toggle" data-machine="KBA">KBA</button>
        <button class="btn toggle" data-line="L2">L2</button>
        <button class="btn toggle" data-line="L3">L3</button>
        <button class="btn toggle" data-machine="DUR">DUR</button>
        <button class="btn toggle" data-machine="INTRO">INTRO</button>
      </div>

      <div class="filters">
        <label><span>Data od</span><input type="date" id="fFrom" placeholder="dd.mm.rrrr"></label>
        <label><span>Data do</span><input type="date" id="fTo" placeholder="dd.mm.rrrr"></label>
        <label><span>Miejsce / segment</span>
          <div class="segment-picker" data-input="fPlace">
            <button type="button" class="segment-trigger"><span>Wybierz segment</span><span aria-hidden="true">▾</span></button>
            <div class="segment-menu">
              <button type="button" data-value="">Wyczyść wybór</button>
              <button type="button" class="segment-option" data-value="Odwijak">Odwijak</button>
              <button type="button" class="segment-option" data-value="Zespół naprężający">Zespół naprężający</button>
              <div class="segment-option has-sub">
                <span>Agregat czarny</span>
                <div class="segment-submenu">
                  <button type="button" data-value="Agregat czarny, góra">Góra</button>
                  <button type="button" data-value="Agregat czarny, dół">Dół</button>
                </div>
              </div>
              <div class="segment-option has-sub">
                <span>Agregat cyjan</span>
                <div class="segment-submenu">
                  <button type="button" data-value="Agregat cyjan, góra">Góra</button>
                  <button type="button" data-value="Agregat cyjan, dół">Dół</button>
                </div>
              </div>
              <div class="segment-option has-sub">
                <span>Agregat magenta</span>
                <div class="segment-submenu">
                  <button type="button" data-value="Agregat magenta, góra">Góra</button>
                  <button type="button" data-value="Agregat magenta, dół">Dół</button>
                </div>
              </div>
              <div class="segment-option has-sub">
                <span>Agregat żółty</span>
                <div class="segment-submenu">
                  <button type="button" data-value="Agregat żółty, góra">Góra</button>
                  <button type="button" data-value="Agregat żółty, dół">Dół</button>
                </div>
              </div>
              <button type="button" class="segment-option" data-value="UW">UW</button>
              <button type="button" class="segment-option" data-value="Suszarka">Suszarka</button>
              <button type="button" class="segment-option" data-value="Chłodnik">Chłodnik</button>
              <button type="button" class="segment-option" data-value="Sylikon">Sylikon</button>
              <button type="button" class="segment-option" data-value="Cięcie wstęgi">Cięcie wstęgi</button>
              <button type="button" class="segment-option" data-value="Przerzutki i registry">Przerzutki i registry</button>
              <button type="button" class="segment-option" data-value="Klejownik">Klejownik</button>
              <button type="button" class="segment-option" data-value="Odcięcie głowa i nogi">Odcięcie głowa i nogi</button>
              <button type="button" class="segment-option" data-value="Odcięcie poprzeczne">Odcięcie poprzeczne</button>
              <button type="button" class="segment-option" data-value="Zszywarka">Zszywarka</button>
              <button type="button" class="segment-option" data-value="Rozdzielacz">Rozdzielacz</button>
              <div class="segment-option has-sub">
                <span>Wykładaki</span>
                <div class="segment-submenu">
                  <button type="button" data-value="Wykładaki, góra">Góra</button>
                  <button type="button" data-value="Wykładaki, dół">Dół</button>
                </div>
              </div>
            </div>
          </div>
          <input type="hidden" id="fPlace">
        </label>
        <label><span>Kod błędu</span><input type="text" id="fErr" placeholder="np. E42"></label>
        <label style="grid-column:1/-1">
          <span>Fragment opisu</span>
          <input type="text" id="fText" placeholder="szukaj w treści">
        </label>

        <div class="filter-actions">
          <button class="btn accent" id="applyBtn">Szukaj</button>
          <button class="btn ghost" id="clearBtn">Wyczyść</button>
          <button class="btn danger" id="deleteBtn" disabled>Usuń</button>
        </div>
      </div>
    </div>
  </section>

  <!-- ŚRODEK: edycja zgłoszenia -->
  <section class="panel details">
    <h2>Edytuj zgłoszenie</h2>

    <div id="place" class="place">
      Wybierz zgłoszenie z listy po lewej lub prawej.
    </div>

    <div class="tabs">
      <input type="radio" id="t1" name="tabs" checked>
      <input type="radio" id="t2" name="tabs">
      <div class="tab-head">
        <label for="t1">Opis operatora</label>
        <label for="t2">Co zrobił serwisant</label>
      </div>

      <div class="tab-body">
        <div id="p1" class="tab-panel">
          <textarea id="opText" placeholder="Brak opisu operatora"></textarea>
        </div>
        <div id="p2" class="tab-panel">
          <textarea id="svcText" placeholder="Brak opisu serwisu"></textarea>
        </div>
      </div>
    </div>

    <aside id="photos" class="photo-strip" aria-label="Zdjęcia">
      <div class="photo empty">Brak zdjęć</div>
    </aside>

    <button class="wide-btn" id="saveBtn" disabled>Zapisz zmiany</button>
  </section>

  <!-- PRAWA: lista zamkniętych do akceptacji -->
  <section class="panel right">
    <h2>Lista oczekujących na akceptację</h2>
    <div class="list" id="pendingList"></div>
    <div class="right-footer">
      <span class="dot active"></span>
      <span class="dot"></span>
      <span class="dot"></span>
    </div>
  </section>
</main>

<!-- Lightbox -->
<div id="lightbox" class="lightbox" role="dialog" aria-modal="true" aria-label="Podgląd zdjęcia">
  <button class="close" id="lbClose" aria-label="Zamknij">Zamknij</button>
  <img id="lbImg" alt="">
</div>

<!-- Modal usunięcia -->
<div id="confirmModal" class="modal" role="dialog" aria-modal="true" aria-label="Potwierdzenie usunięcia">
  <div class="modal-box">
    <div class="modal-title">Usunąć zgłoszenie?</div>
    <p class="modal-text">Czy na pewno chcesz usunąć to zgłoszenie? Tej operacji nie można cofnąć.</p>
    <div class="modal-actions">
      <button class="btn ghost" id="confirmNo">Anuluj</button>
      <button class="btn danger" id="confirmYes">Usuń</button>
    </div>
  </div>
</div>

<script>
/* MOCK DANYCH – status: open/ok, reviewed: czy kierownik zatwierdził */
const ALL=[
  {
    id:1,
    title:"KBA Compacta 818 — sekcja 3 — błąd E42",
    meta:"Zgłoszono: 2025-01-05 12:04 | Operator: J.D.",
    status:"open",
    reviewed:false,
    place:"KBA C818 → Sekcja 3 → Kod: E42",
    machine:"KBA",
    line:"L3",
    error:"E42",
    date:"2025-01-05",
    op:"Podczas startu sekcji 3 pojawia się błąd E42. Maszyna nie pobiera wstęgi z odwijaka. Po skasowaniu błąd wraca natychmiast.",
    svc:"Podejrzenie czujnika prędkości rolki prowadzącej.",
    photos:["https://picsum.photos/1000/700?random=11","https://picsum.photos/1000/700?random=12"]
  },
  {
    id:2,
    title:"Roland Lithoman IV — odwijak A — czujnik taśmy",
    meta:"Zgłoszono: 2025-01-04 10:31 | Operator: A.K.",
    status:"open",
    reviewed:false,
    place:"Roland Lithoman IV → Odwijak A → Czujnik taśmy",
    machine:"KBA",
    line:"L2",
    error:"E07",
    date:"2025-01-04",
    op:"Czujnik taśmy gubi impuls. Pasek zatrzymuje się.",
    svc:"Korekta prowadzenia przewodu. Wymiana czujnika. Test 2 h.",
    photos:["https://picsum.photos/1000/700?random=21"]
  },
  {
    id:3,
    title:"DUR — kompresor Atlas — wymiana filtra oleju",
    meta:"Zamknięto: 2025-01-03 09:12 | Serwis: M.S.",
    status:"ok",
    reviewed:true,
    place:"Kompresor Atlas → Filtr oleju",
    machine:"DUR",
    line:"L2",
    error:"",
    date:"2025-01-03",
    op:"Wzrost temperatury o 15°C. Filtr zatkany.",
    svc:"Wymieniono filtr, temp. w normie.",
    photos:[]
  },
  {
    id:4,
    title:"Wymiana łożysk — sekcja zwijaka",
    meta:"Zamknięto: 2025-10-28 | Serwis: P.N.",
    status:"ok",
    reviewed:false,
    place:"KBA C818 → Sekcja zwijaka",
    machine:"KBA",
    line:"L3",
    error:"",
    date:"2025-10-28",
    op:"Hałas z sekcji zwijaka przy prędkości powyżej 30k egz/h.",
    svc:"Wymieniono komplet łożysk, dociążono rolkę dociskową.",
    photos:["https://picsum.photos/1000/700?random=31"]
  },
  {
    id:5,
    title:"Kalibracja rejestru — linia 2",
    meta:"Zamknięto: 2025-10-24 | Serwis: K.R.",
    status:"ok",
    reviewed:false,
    place:"Linia 2 → Rejestr wzdłużny",
    machine:"INTRO",
    line:"L2",
    error:"",
    date:"2025-10-24",
    op:"Operator zgłasza rozjechanie nadruku o 1.5 mm.",
    svc:"Przeprowadzono kalibrację rejestru, test: 20 tys. nakładu.",
    photos:[]
  }
];

const F={from:null,to:null,place:"",text:"",err:"",machine:new Set(),line:new Set(),sortDesc:true};
let selectedId=null;

/* elementy DOM */
const $allList=document.getElementById('allList');
const $pendingList=document.getElementById('pendingList');
const $place=document.getElementById('place');
const $opText=document.getElementById('opText');
const $svcText=document.getElementById('svcText');
const $photos=document.getElementById('photos');
const $saveBtn=document.getElementById('saveBtn');
const $deleteBtn=document.getElementById('deleteBtn');
const $sortBtn=document.getElementById('sortBtn');
const $modal=document.getElementById('confirmModal');
const $confirmYes=document.getElementById('confirmYes');
const $confirmNo=document.getElementById('confirmNo');

function initSegments(){
  document.querySelectorAll('.segment-picker').forEach(picker=>{
    const inputId=picker.dataset.input;
    const hidden=document.getElementById(inputId);
    const trigger=picker.querySelector('.segment-trigger');
    const label=trigger?.querySelector('span');
    trigger?.addEventListener('click',()=>picker.classList.toggle('open'));
    picker.querySelectorAll('[data-value]').forEach(btn=>{
      btn.addEventListener('click',e=>{
        e.stopPropagation();
        const val=btn.getAttribute('data-value')||'';
        if(hidden){ hidden.value=val; hidden.dispatchEvent(new Event('input')); }
        if(label) label.textContent=val||'Wybierz segment';
        picker.classList.remove('open');
      });
    });
  });
  document.addEventListener('click',e=>{
    document.querySelectorAll('.segment-picker.open').forEach(p=>{
      if(!p.contains(e.target)) p.classList.remove('open');
    });
  });
}
initSegments();

/* Lightbox */
const $lb=document.getElementById('lightbox');
const $lbImg=document.getElementById('lbImg');
document.getElementById('lbClose').addEventListener('click',closeLightbox);
$lb.addEventListener('click',e=>{ if(e.target===$lb) closeLightbox(); });
document.addEventListener('keydown',e=>{ if(e.key==='Escape'){ closeLightbox(); }});
function openLightbox(src){ $lbImg.src=src; $lb.classList.add('open'); }
function closeLightbox(){ $lb.classList.remove('open'); $lbImg.src=''; }

/* render lewej listy */
function renderList(){
  let q=[...ALL];

  q.sort((a,b)=>{
    const wA=a.status==="ok"?1:0;
    const wB=b.status==="ok"?1:0;
    if(wA!==wB) return wA-wB;               // najpierw otwarte
    const dA=new Date(a.date), dB=new Date(b.date);
    return F.sortDesc ? dB-dA : dA-dB;
  });

  if(F.machine.size) q=q.filter(t=>F.machine.has(t.machine));
  if(F.line.size) q=q.filter(t=>F.line.has(t.line));
  if(F.from) q=q.filter(t=> new Date(t.date)>=new Date(F.from));
  if(F.to) q=q.filter(t=> new Date(t.date)<=new Date(F.to));
  if(F.place) q=q.filter(t=>(t.place||"").toLowerCase().includes(F.place.toLowerCase()));
  if(F.err) q=q.filter(t=>(t.error||"").toLowerCase().includes(F.err.toLowerCase()));
  if(F.text) q=q.filter(t=>(t.op+t.svc).toLowerCase().includes(F.text.toLowerCase()));

  $allList.innerHTML='';
  if(!q.length){
    $allList.innerHTML='<div class="empty">Brak zgłoszeń</div>';
    return;
  }

  q.forEach(t=>{
    const el=document.createElement('article');
    el.className='item';
    el.dataset.id=t.id;
    let statusBadge=`<span class="badge ${t.status==='ok'?'ok':'open'}">${t.status==='ok'?'zamknięte':'otwarte'}</span>`;
    if(t.status==='ok' && t.reviewed){
      statusBadge+=` <span class="badge check" title="Zweryfikowano">&#10003;</span>`;
    }
    el.innerHTML=`
      <div>
        <div class="title">${t.title}</div>
        <div class="meta">${t.meta}</div>
      </div>
      <div>${statusBadge}</div>
    `;
    el.addEventListener('click',()=>select(t.id));
    $allList.appendChild(el);
  });

  updateActiveClasses();
}

/* prawa lista */
function renderPending(){
  const pending=ALL.filter(t=>t.status==='ok' && !t.reviewed)
                   .sort((a,b)=>new Date(b.date)-new Date(a.date));
  $pendingList.innerHTML='';
  if(!pending.length){
    $pendingList.innerHTML='<div class="empty">Brak zgłoszeń do akceptacji</div>';
    return;
  }
  pending.forEach(t=>{
    const el=document.createElement('article');
    el.className='item';
    el.dataset.id=t.id;
    el.innerHTML=`
      <div>
        <div class="title">${t.title}</div>
        <div class="meta">${t.meta}</div>
      </div>
      <div><span class="badge ok">zamknięte</span></div>
    `;
    el.addEventListener('click',()=>select(t.id));
    $pendingList.appendChild(el);
  });

  updateActiveClasses();
}

/* wspólne zaznaczenie */
function updateActiveClasses(){
  document.querySelectorAll('.list .item').forEach(el=>{
    const id=Number(el.dataset.id);
    el.classList.toggle('active', id===selectedId);
  });
}

/* wybór zgłoszenia */
function select(id){
  selectedId=id;
  const t=ALL.find(x=>x.id===id);
  if(!t) return;

  updateActiveClasses();

  $place.textContent="Miejsce: "+(t.place||"");
  $opText.value=t.op||"";
  $svcText.value=t.svc||"";
  $saveBtn.disabled=false;
  $deleteBtn.disabled=false;

  renderPhotos(t);
}

/* zdjęcia + dodawanie/usuwanie */
function renderPhotos(t){
  $photos.innerHTML='';
  if(!t.photos.length){
    const empty=document.createElement('div');
    empty.className='photo empty';
    empty.textContent='Brak zdjęć';
    $photos.appendChild(empty);
  }else{
    t.photos.forEach((src,idx)=>{
      const fig=document.createElement('figure');
      fig.className='photo';
      fig.innerHTML=`<img src="${src}" alt=""><button class="photo-remove" aria-label="Usuń zdjęcie">×</button>`;
      fig.querySelector('img').addEventListener('click',()=>openLightbox(src));
      fig.querySelector('.photo-remove').addEventListener('click',e=>{
        e.stopPropagation();
        t.photos.splice(idx,1);
        renderPhotos(t);
      });
      $photos.appendChild(fig);
    });
  }

  const add=document.createElement('button');
  add.type='button';
  add.className='add-photo';
  add.textContent='+ Dodaj zdjęcie';
  add.addEventListener('click',()=>{
    const url=prompt('Podaj adres URL zdjęcia');
    if(url){
      t.photos.push(url.trim());
      renderPhotos(t);
    }
  });
  $photos.appendChild(add);
}

/* filtrowanie */
function toggleBtn(btn, group){
  btn.classList.toggle('active');
  const val=btn.dataset[group];
  if(!val) return;
  const set=F[group];
  if(btn.classList.contains('active')) set.add(val); else set.delete(val);
  renderList();
}
document.querySelectorAll('[data-machine]')
  .forEach(b=>b.addEventListener('click',()=>toggleBtn(b,'machine')));
document.querySelectorAll('[data-line]')
  .forEach(b=>b.addEventListener('click',()=>toggleBtn(b,'line')));

document.getElementById('applyBtn').addEventListener('click',()=>{
  F.from=document.getElementById('fFrom').value||null;
  F.to=document.getElementById('fTo').value||null;
  F.place=document.getElementById('fPlace').value;
  F.err=document.getElementById('fErr').value;
  F.text=document.getElementById('fText').value;
  renderList();
});

document.getElementById('clearBtn').addEventListener('click',()=>{
  ['fFrom','fTo','fPlace','fErr','fText'].forEach(id=>document.getElementById(id).value='');
  F.from=F.to=null;
  F.place=F.text=F.err="";
  F.machine.clear();
  F.line.clear();
  document.querySelectorAll('.btn.toggle.active').forEach(b=>b.classList.remove('active'));
  renderList();
});

/* sortowanie */
$sortBtn.addEventListener('click',()=>{
  F.sortDesc=!F.sortDesc;
  $sortBtn.textContent=F.sortDesc?'Sortuj ↓ data':'Sortuj ↑ data';
  renderList();
});

/* zapisz zmiany */
$saveBtn.addEventListener('click',()=>{
  if(!selectedId) return;
  const t=ALL.find(x=>x.id===selectedId);
  if(!t) return;
  t.op=$opText.value;
  t.svc=$svcText.value;
  if(t.status==='ok'){
    t.reviewed=true;     // zielona fajka + znika z prawej
  }
  renderList();
  renderPending();
});

/* usuwanie zgłoszenia */
$deleteBtn.addEventListener('click',()=>{
  if(!selectedId) return;
  $modal.classList.add('open');
});
$confirmNo.addEventListener('click',()=>{$modal.classList.remove('open');});
$confirmYes.addEventListener('click',()=>{
  if(!selectedId) return;
  const idx=ALL.findIndex(x=>x.id===selectedId);
  if(idx>=0) ALL.splice(idx,1);
  selectedId=null;
  $place.textContent='Wybierz zgłoszenie z listy po lewej lub prawej.';
  $opText.value='';
  $svcText.value='';
  $photos.innerHTML='<div class="photo empty">Brak zdjęć</div>';
  $saveBtn.disabled=true;
  $deleteBtn.disabled=true;
  $modal.classList.remove('open');
  renderList();
  renderPending();
});

/* start */
renderList();
renderPending();
</script>
</body>
</html>
